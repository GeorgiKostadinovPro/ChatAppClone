@inject UserManager<ApplicationUser> UserManager

@{
    var user = await UserManager.GetUserAsync(User);
    var profile = user?.ProfilePictureUrl ?? "https://www.shutterstock.com/image-vector/default-avatar-profile-icon-social-600nw-1677509740.jpg";
}

<div id="loading-overlay" style="display: none;">
    <div class="spinner"></div>
    <p>Uploading your profile picture, please wait...</p>
</div>

<div class="col-md-3">
    <div href=# class="d-inline">
        <img id="user-profile-picture" src="@profile"><br>
        <p class="pl-2 mt-2">
            <label style="margin-bottom: 0.5em;">Edit Picture</label>
            <input type="file" accept=".png, .jpg, .jpeg" id="profile-picture-input">
            <span class="text-danger profile-picture-error-span" id="validation-message"></span>

            <div class="profile-picture-action-section">
                <button id="upload-button" class="btn upload-picture-btn" type="button">Upload</button>
            </div>
        </p>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#upload-button').on('click', function (e) {
            e.preventDefault();

            var fileInput = $('#profile-picture-input')[0];
            var file = fileInput.files[0];

            var formData = new FormData();
            formData.append('file', file);

            $('#loading-overlay').show();

            $.ajax({
                url: '@Url.Action("UploadProfilePicture", "User")',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        location.reload();
                    } else {
                        $('#validation-message').text(response.error);
                    }
                },
                error: function () {
                    $('#validation-message').text('An error occurred while uploading the picture.');
                },
                complete: function () {
                    $('#loading-overlay').hide();
                }
            });
        });
    });
</script>
